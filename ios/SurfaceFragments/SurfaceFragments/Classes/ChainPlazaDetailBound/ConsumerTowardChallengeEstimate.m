
#import <Foundation/Foundation.h>

NSString *StringFromTotalo_Data(Byte *data);


//: {18,25,17,25}
Byte commonTacticCounteractPreference[] = {94, 13, 3, 4, 126, 52, 59, 47, 53, 56, 47, 52, 58, 47, 53, 56, 128, 186};

//: 聊天记录
Byte kStrengthTimer[] = {41, 12, 44, 6, 47, 240, 20, 173, 182, 17, 208, 213, 20, 218, 220, 17, 233, 193, 113};

//: null
Byte commonVariableKey[] = {60, 4, 79, 4, 189, 196, 187, 187, 105};

//: SendTextViewBkg
Byte layoutDecorateError[] = {99, 15, 28, 14, 151, 250, 167, 183, 158, 21, 69, 223, 219, 146, 111, 129, 138, 128, 112, 129, 148, 144, 114, 133, 129, 147, 94, 135, 131, 22};

//: NIMDemoEventNameOpenMergeMessage
Byte constHydrateRealmMessage[] = {88, 32, 19, 5, 249, 97, 92, 96, 87, 120, 128, 130, 88, 137, 120, 129, 135, 97, 116, 128, 120, 98, 131, 120, 129, 96, 120, 133, 122, 120, 96, 120, 134, 134, 116, 122, 120, 121};

// __DEBUG__
// __CLOSE_PRINT__
//
//  ConsumerTowardChallengeEstimate.m
//  NIM
//
//  Created by Netease on 2019/10/17.
//  Copyright © 2019 Netease. All rights reserved.
//

// __M_A_C_R_O__
//: #import "ConsumerTowardChallengeEstimate.h"
#import "ConsumerTowardChallengeEstimate.h"
//: #import "TowardSaverOperatorJungle.h"
#import "TowardSaverOperatorJungle.h"
//: #import "UIView+Layout.h"
#import "UIView+Layout.h"
//: #import "ShadedPowerMarkAcknowledge+RunBonnyJourneyTweak.h"
#import "ShadedPowerMarkAcknowledge+RunBonnyJourneyTweak.h"

//: @interface ConsumerTowardChallengeEstimate ()
@interface ConsumerTowardChallengeEstimate ()

//: @property (nonatomic, strong) UILabel *titleLabel;
@property (nonatomic, strong) UILabel *taskAcross;

//: @property (nonatomic, strong) UIButton *touchBtn;
@property (nonatomic, strong) UIButton *trackSame;

//: @property (nonatomic, strong) UIImage *bkNormalImage;
@property (nonatomic, strong) UIImage *pressure;

//: @property (nonatomic, strong) UIView *line;
@property (nonatomic, strong) UIView *commonPart;

//: @property (nonatomic, strong) UILabel *subTitleLabel;
@property (nonatomic, strong) UILabel *flame;

//: @property (nonatomic, strong) NSMutableArray <ShadedPowerMarkAcknowledge *> *messageLabs;
@property (nonatomic, strong) NSMutableArray <ShadedPowerMarkAcknowledge *> *sunny;

//: @end
@end

//: @implementation ConsumerTowardChallengeEstimate
@implementation ConsumerTowardChallengeEstimate

//: - (void)refresh:(SplitPortDuplicateSlice *)data{
- (void)operation:(SplitPortDuplicateSlice *)data{
    //: [super refresh:data];
    [super operation:data];

    //: NIMCustomObject *object = data.message.messageObject;
    NIMCustomObject *object = data.mActive.messageObject;
    //: TowardSaverOperatorJungle *attachment = (TowardSaverOperatorJungle *)object.attachment;
    TowardSaverOperatorJungle *attachment = (TowardSaverOperatorJungle *)object.attachment;

    //: [_messageLabs makeObjectsPerformSelector:@selector(removeFromSuperview)];
    [_sunny makeObjectsPerformSelector:@selector(removeFromSuperview)];
    //: [_messageLabs removeAllObjects];
    [_sunny removeAllObjects];

    //: _titleLabel.text = [attachment formatTitleMessage];
    _taskAcross.text = [attachment result];

    //: for (AlignmentUpdate *abstract in attachment.abstracts) {
    for (AlignmentUpdate *abstract in attachment.ownerSoft) {
        //: ShadedPowerMarkAcknowledge *lab = [self setupMessageLabel];
        ShadedPowerMarkAcknowledge *lab = [self always];
        //: [lab nim_setText:[attachment formatAbstractMessage:abstract]];
        [lab old:[attachment generous:abstract]];
        //: [_messageLabs addObject:lab];
        [_sunny addObject:lab];
        //: [self addSubview:lab];
        [self addSubview:lab];
    }
    //: [self layoutIfNeeded];
    [self layoutIfNeeded];
}

//: #pragma mark - Action
#pragma mark - Action
//: - (void)touchAction:(UIButton *)sender {
- (void)fragmentGrowing:(UIButton *)sender {
    //: if ([self.delegate respondsToSelector:@selector(onCatchEvent:)]) {
    if ([self.amendPartses respondsToSelector:@selector(necessaries:)]) {
        //: ZoneOnyxOpal *event = [[ZoneOnyxOpal alloc] init];
        ZoneOnyxOpal *event = [[ZoneOnyxOpal alloc] init];
        //: event.eventName = @"NIMDemoEventNameOpenMergeMessage";
        event.package = StringFromTotalo_Data(constHydrateRealmMessage);
        //: event.messageModel = self.model;
        event.reject = self.blue;
        //: event.data = self;
        event.dry = self;
        //: [self.delegate onCatchEvent:event];
        [self.amendPartses necessaries:event];
    }
}

//: - (UIView *)line {
- (UIView *)commonPart {
    //: if (!_line) {
    if (!_commonPart) {
        //: _line = [[UIView alloc] init];
        _commonPart = [[UIView alloc] init];
        //: _line.backgroundColor = [UIColor lightGrayColor];
        _commonPart.backgroundColor = [UIColor lightGrayColor];
    }
    //: return _line;
    return _commonPart;
}

//: - (ShadedPowerMarkAcknowledge *)setupMessageLabel {
- (ShadedPowerMarkAcknowledge *)always {
    //: ShadedPowerMarkAcknowledge *ret = [[ShadedPowerMarkAcknowledge alloc] initWithFrame:CGRectZero];
    ShadedPowerMarkAcknowledge *ret = [[ShadedPowerMarkAcknowledge alloc] initWithFrame:CGRectZero];
    //: ret.textColor = [UIColor lightGrayColor];
    ret.textColor = [UIColor lightGrayColor];
    //: ret.font = [UIFont systemFontOfSize:11];
    ret.font = [UIFont systemFontOfSize:11];
    //: ret.numberOfLines = 1;
    ret.movieDrainShared = 1;
    //: ret.backgroundColor = [UIColor clearColor];
    ret.backgroundColor = [UIColor clearColor];
    //: return ret;
    return ret;
}

//: - (UILabel *)setupContentLabel {
- (UILabel *)broadcast {
    //: UILabel *ret = [[UILabel alloc] init];
    UILabel *ret = [[UILabel alloc] init];
    //: ret.textColor = [UIColor lightGrayColor];
    ret.textColor = [UIColor lightGrayColor];
    //: ret.font = [UIFont systemFontOfSize:11];
    ret.font = [UIFont systemFontOfSize:11];
    //: ret.textAlignment = NSTextAlignmentLeft;
    ret.textAlignment = NSTextAlignmentLeft;
    //: ret.text = @"null";
    ret.text = StringFromTotalo_Data(commonVariableKey);
    //: ret.backgroundColor = [UIColor clearColor];
    ret.backgroundColor = [UIColor clearColor];
    //: [ret sizeToFit];
    [ret sizeToFit];
    //: return ret;
    return ret;
}

//: - (instancetype)initSessionMessageContentView{
- (instancetype)initDefiniteAcross{
    //: self = [super initSessionMessageContentView];
    self = [super initDefiniteAcross];
    //: if (self) {
    if (self) {
        //: static UIImage *bkNormalImage = nil;
        static UIImage *bkNormalImage = nil;
        //: static dispatch_once_t onceToken;
        static dispatch_once_t onceToken;
        //: _dispatch_once(&onceToken, ^{
        _dispatch_once(&onceToken, ^{
            //: bkNormalImage = [[UIImage imageNamed:@"SendTextViewBkg"] resizableImageWithCapInsets:UIEdgeInsetsFromString(@"{18,25,17,25}") resizingMode:UIImageResizingModeStretch];
            bkNormalImage = [[UIImage imageNamed:StringFromTotalo_Data(layoutDecorateError)] resizableImageWithCapInsets:UIEdgeInsetsFromString(StringFromTotalo_Data(commonTacticCounteractPreference)) resizingMode:UIImageResizingModeStretch];
        //: });
        });
        //: _bkNormalImage = bkNormalImage;
        _pressure = bkNormalImage;
        //: _messageLabs = [NSMutableArray array];
        _sunny = [NSMutableArray array];
        //: [self addSubview:self.titleLabel];
        [self addSubview:self.taskAcross];
        //: [self addSubview:self.line];
        [self addSubview:self.commonPart];
        //: [self addSubview:self.subTitleLabel];
        [self addSubview:self.flame];
        //: [self addSubview:self.touchBtn];
        [self addSubview:self.trackSame];
    }
    //: return self;
    return self;
}

//: - (UIImage *)chatBubbleImageForState:(UIControlState)state outgoing:(BOOL)outgoing {
- (UIImage *)enhance:(UIControlState)state skilled:(BOOL)outgoing {
    //: return _bkNormalImage;
    return _pressure;
}

//: - (UILabel *)subTitleLabel {
- (UILabel *)flame {
    //: if (!_subTitleLabel) {
    if (!_flame) {
        //: _subTitleLabel = [self setupContentLabel];
        _flame = [self broadcast];
        //: _subTitleLabel.text = @"聊天记录".user_localized;
        _flame.text = StringFromTotalo_Data(kStrengthTimer).nativeDown;
        //: [_subTitleLabel sizeToFit];
        [_flame sizeToFit];
    }
    //: return _subTitleLabel;
    return _flame;
}


//: #pragma mark - Getter
#pragma mark - Getter
//: - (UILabel *)titleLabel {
- (UILabel *)taskAcross {
    //: if (!_titleLabel) {
    if (!_taskAcross) {
        //: _titleLabel = [[UILabel alloc] init];
        _taskAcross = [[UILabel alloc] init];
        //: _titleLabel.font = [UIFont systemFontOfSize:14];
        _taskAcross.font = [UIFont systemFontOfSize:14];
        //: _titleLabel.text = @"null";
        _taskAcross.text = StringFromTotalo_Data(commonVariableKey);
        //: _titleLabel.textAlignment = NSTextAlignmentLeft;
        _taskAcross.textAlignment = NSTextAlignmentLeft;
        //: [_titleLabel sizeToFit];
        [_taskAcross sizeToFit];
    }
    //: return _titleLabel;
    return _taskAcross;
}

//: - (UIButton *)touchBtn {
- (UIButton *)trackSame {
    //: if (!_touchBtn) {
    if (!_trackSame) {
        //: _touchBtn = [UIButton buttonWithType:UIButtonTypeCustom];
        _trackSame = [UIButton buttonWithType:UIButtonTypeCustom];
        //: [_touchBtn addTarget:self action:@selector(touchAction:) forControlEvents:UIControlEventTouchUpInside];
        [_trackSame addTarget:self action:@selector(fragmentGrowing:) forControlEvents:UIControlEventTouchUpInside];
    }
    //: return _touchBtn;
    return _trackSame;
}

//: - (void)layoutSubviews{
- (void)layoutSubviews{
    //: [super layoutSubviews];
    [super layoutSubviews];
    //: CGFloat padding = 4.0;
    CGFloat padding = 4.0;
    //: CGFloat inset = 12.0;
    CGFloat inset = 12.0;
    //: _titleLabel.frame = CGRectMake(inset, inset, self.width - 2*inset, _titleLabel.height);
    _taskAcross.frame = CGRectMake(inset, inset, self.kick - 2*inset, _taskAcross.minimum);
    //: if (_messageLabs.count != 0) {
    if (_sunny.count != 0) {
        //: __weak typeof(self) weakSelf = self;
        __weak typeof(self) weakSelf = self;
        //: __block CGFloat yOffset = 0;
        __block CGFloat yOffset = 0;
        //: [_messageLabs enumerateObjectsUsingBlock:^(ShadedPowerMarkAcknowledge * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        [_sunny enumerateObjectsUsingBlock:^(ShadedPowerMarkAcknowledge * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
            //: CGSize size = [obj sizeThatFits:CGSizeMake(weakSelf.titleLabel.width, 1.7976931348623157e+308)];
            CGSize size = [obj sizeThatFits:CGSizeMake(weakSelf.taskAcross.kick, 1.7976931348623157e+308)];
            //: obj.frame = CGRectMake(_titleLabel.left, _titleLabel.bottom + 4.0 + yOffset, size.width, size.height);
            obj.frame = CGRectMake(_taskAcross.reduction, _taskAcross.nextResume + 4.0 + yOffset, size.width, size.height);
            //: yOffset += (obj.height + padding);
            yOffset += (obj.minimum + padding);
        //: }];
        }];
        //: ShadedPowerMarkAcknowledge *lastLab = [_messageLabs lastObject];
        ShadedPowerMarkAcknowledge *lastLab = [_sunny lastObject];
        //: _line.frame = CGRectMake(_titleLabel.left, lastLab.bottom + padding, _titleLabel.width, 1.0);
        _commonPart.frame = CGRectMake(_taskAcross.reduction, lastLab.nextResume + padding, _taskAcross.kick, 1.0);
    //: } else {
    } else {
        //: _line.frame = CGRectMake(_titleLabel.left, _titleLabel.bottom + padding, _titleLabel.width, 1.0);
        _commonPart.frame = CGRectMake(_taskAcross.reduction, _taskAcross.nextResume + padding, _taskAcross.kick, 1.0);
    }
    //: _subTitleLabel.origin = CGPointMake(_titleLabel.left, _line.bottom + padding);
    _flame.background = CGPointMake(_taskAcross.reduction, _commonPart.nextResume + padding);
    //: _touchBtn.frame = self.bounds;
    _trackSame.frame = self.bounds;
}
//: @end
@end

Byte * Totalo_DataToCache(Byte *data) {
    int result = data[0];
    int supply = data[1];
    Byte levelPanelJungle = data[2];
    int title = data[3];
    if (!result) return data + title;
    for (int i = title; i < title + supply; i++) {
        int value = data[i] - levelPanelJungle;
        if (value < 0) {
            value += 256;
        }
        data[i] = value;
    }
    data[0] = 0;
    data[title + supply] = 0;
    return data + title;
}

NSString *StringFromTotalo_Data(Byte *data) {
    return [NSString stringWithUTF8String:(char *)Totalo_DataToCache(data)];
}
